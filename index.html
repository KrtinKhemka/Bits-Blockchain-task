<!DOCTYPE html>
<html>

<head>
	<title>CONNECTION TO METAMASK</title>
	<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/web3/1.2.7-rc.0/web3.min.js"></script>
	<style>
		body {
			background-color: black;
			font-size: 33px;
			text-align: center;
		}

		button {
			background-color: white;
			font-size: 33px;
			font-family: Impact, Haettenschweiler, 'Arial Narrow Bold', sans-serif;
		}

		button:hover {
			background-color: yellow;
		}

		p {
			color: white;
		}
	

	</style>
</head>

<body>
	<button onclick="connectMetamask()">CONNECT TO METAMASK</button> <br>
	<p id="accountArea"></p>
	<!-- <button onclick="connectContract()">CONNECT TO CONTRACT</button> <br> -->
	<p id="contractArea"></p>
	<!-- <button onclick="deployContract()">DEPLOY CONTRACT</button> <br> -->
	<p id="ConfrirmationArea"></p>
	<button onclick="readContract()">GET DATA FROM CONTRACT</button> <br>
	<p id="dataArea"></p>
	<button onclick="loadQuestions()">Load qs</button> <br>
	<p id="questionset"></p>
	<p id="myText"></p>
<button type="button" id="myBtn">Next Question</button>

	<script>
		document.getElementById('myBtn').style.visibility= 'hidden'
		document.getElementById('myText').style.visibility= 'hidden'
		//connect metamask
		let account;
		const connectMetamask = async () => {
			if (window.etheruem !== "undefined") {
				const accounts = await ethereum.request({
					method: "eth_requestAccounts"
				});
				account = accounts[0];
				document.getElementById("accountArea").innerHTML = account;

			}
			const ABI = [{
					"inputs": [],
					"name": "getlistofquest",
					"outputs": [],
					"stateMutability": "nonpayable",
					"type": "function"
				},
				{
					"inputs": [],
					"stateMutability": "nonpayable",
					"type": "constructor"
				},
				{
					"inputs": [],
					"name": "keccakcount",
					"outputs": [{
						"internalType": "uint256",
						"name": "",
						"type": "uint256"
					}],
					"stateMutability": "view",
					"type": "function"
				},
				{
					"inputs": [],
					"name": "len",
					"outputs": [{
						"internalType": "uint256",
						"name": "",
						"type": "uint256"
					}],
					"stateMutability": "view",
					"type": "function"
				},
				{
					"inputs": [{
						"internalType": "uint256",
						"name": "",
						"type": "uint256"
					}],
					"name": "listofquesnos",
					"outputs": [{
						"internalType": "uint256",
						"name": "",
						"type": "uint256"
					}],
					"stateMutability": "view",
					"type": "function"
				},
				{
					"inputs": [],
					"name": "randomnumber",
					"outputs": [{
						"internalType": "uint256",
						"name": "",
						"type": "uint256"
					}],
					"stateMutability": "view",
					"type": "function"
				}
			];
			const Address = "0x2399765FAdd6532e3C11CE7C0c01B0Ed7F36E1ce";
			window.web3 = await new Web3(window.ethereum);
			window.contract = await new window.web3.eth.Contract(ABI, Address);
			document.getElementById("contractArea").innerHTML = "connected to smart contract";
			window.contract.methods.getlistofquest().send({
				from: account
			});
			document.getElementById("ConfrirmationArea").innerHTML = " Smart Contract Deployed"
			

		}
		// reading listof ques
		var newtmps = [];
		const readContract = async () => {
			// window.contract.methods.getlistofquest().send({from:account});



			const tmps = await Promise.all(
				Array(10)
				.fill()
				.map((element, index) => {
					return window.contract.methods.listofquesnos(index).call();
				})
			)
			document.getElementById("dataArea").innerHTML = tmps
			newtmps = tmps;
		}
		// reading values from json

		// printing values from questions

		var allQuestions = new Array();
		var questions= new Array();
		var xounter=0;

		function loadQuestions() {

			let xhttp = new XMLHttpRequest();
			xhttp.onreadystatechange = function () {
				if (xhttp.readyState == 4 && xhttp.status == 200) {
					var data = JSON.parse(xhttp.responseText);

					//const questions = [];
					for (let i = 0; i < 10; i++) {
						var num = newtmps[i];
						var item = data.quiz[num - 1];
						questions.push(item);

					}
					//if(xounter==0){document.getElementById("questionset").innerHTML = questions;
				//xounter++;}
				if(questions.length==10){
			document.getElementById('myBtn').style.visibility= 'visible';
				document.getElementById('myText').style.visibility= 'visible';
		var texts = questions;
    btn = document.getElementById("myBtn"),
    text = document.getElementById("myText"),
    index = 0;

btn.addEventListener("click", changeText);
text.innerHTML = texts[0];

function changeText() {
    index++;
    index %= texts.length
    text.innerHTML = texts[index];
}}
				
					

				}
				// else {
				// 	document.getElementById("questionset").innerHTML = "connectionerror";
				// }
			}
			xhttp.open("GET", "SampleQB.json", true);
			xhttp.send();



		}
		if(questions.length==10){
			document.getElementById('myBtn').style.visibility= 'visible';
				document.getElementById('myText').style.visibility= 'visible';
		var texts = questions;
    btn = document.getElementById("myBtn"),
    text = document.getElementById("myText"),
    index = 0;

btn.addEventListener("click", changeText);
text.innerHTML = texts[0];

function changeText() {
    index++;
    index %= texts.length
    text.innerHTML = texts[index];
}}
		
	</script>

</body>

</html>